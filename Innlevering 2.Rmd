---
title: Innlevering 2
author: Innlevering 2 i Data Science 2021 - Maren Sognefest og Daniel Karstad
Affiliation: HVL
email: 152148@stud.hvl.no & 598289@stud.hvl.no
bibliography: Innlevering2.bib
bib-humanities: true
nocite: 
lang: no-NB
fontsize: 12pt
linestretch: 1.5
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
  html_notebook: default
---

```{r echo=FALSE}
library(modelr) 
library(ggplot2) 
library(knitr) 
library(tinytex) 
library(tidyverse) 
library(ggpubr)
data('heights', package = 'modelr')
```

# Er det høyde som bestemmer inntekt?

Denne artikkelen skal ta for seg om det er en, og eventuelt hvilken, sammenheng det er mellom høyde og inntekt. Ved hjelp av flere analyser, skal vi bruke datasettet *heights* fra pakken *modelr* skal vi prøve å finne ut om det er en sammenheng. Kan det stemme at høye personer tjener mest?

I analyse-delen av artikkelen vil vi bruke ulike **plots** for å analysere spørsmålet, og komme frem til en konklusjon.

**Vi må ha ca 1 side litteraturgjennomgang her. Jeg har laget et zotero-bibliotek som ligger ved her. Må gjerne ha inn noen flere kilder vi kan bruke til denne delen**

```{r echo=FALSE}
knitr::kable(summary(heights[1:8]), "pipe")
```

Over er sammendraget av statistikken i datasettet "heights". Man har kolonner med inntekt i dollar, høyde i tommer, vekt i pound, alder, sivilstatus, kjønn, utdannelse og score på Armed Forces Qualitication Test.

Under har vi kopiert datasettet "heights" og kalt det "hoyde". Her har vi regnet dataen om til europeiske standarderer; vi bruker høyde i cm og vekt i kg, i tillegg til at inntekten er i norske kroner, at vi har laget en egen kolonne for BMI og at vi har laget en forenklet utgave av marital (married - not married). Det er også et sammendrag av dette under.

```{r echo=TRUE}
hoyde <-   heights %>%
mutate(heights, hoyde_cm = height*2.54, #høyde i cm = hoyde i tommer * 2,54 fordi 1 tommer = 2,54 cm
       vekt_kg = weight/2.2, #vekt i kg = vekt i pound / 2.2 fordi 2,2 kg = 1 pound
       inntekt_nok = income*8.5,  #inntekt i nok = inntekt i dollar * 8,5 fordi 1 dollar = 8,5 kr
        married = factor(
          case_when(
            marital == 'married' ~ TRUE,
            TRUE ~ FALSE)
          )
       )
hoyde$bmi <- hoyde$vekt_kg/(hoyde$hoyde_cm/100)/(hoyde$hoyde_cm/100) #bmi = vekt i kg / (hoyde i m)^2
hoyde$weight <- NULL #fjerner vekt i pounds fra datasett
hoyde$height <- NULL #fjerner høyde i tommer fra datasett
hoyde$income <- NULL #fjerner inntekt i dollar fra datasett
  
knitr::kable(summary(hoyde[1:5]))
knitr::kable(summary(hoyde[6:10]), "pipe")

```

# EDA (vha. ggplot) av datasettet.

```{r echo=FALSE}
library(ggplot2) #data visualization
library(dplyr) #data manipulation
library(ISLR) #for the dataset

ggplot(data = hoyde, aes(x = inntekt_nok, y = hoyde_cm)) + geom_point(color = "blue") + theme_dark() 

```

```{r echo=FALSE}
#hoyde <-   heights %>%
x <- hoyde$hoyde_cm
y <- hoyde$inntekt_nok
#ggplot(hoyde,aes(x))+geom_histogram(bins=20)
height_cm <- heights$height_cm
hist(x, 
     breaks = 18,
     main = "Høyde i centimeter",
     ylab = "Frekvens",
     xlab = "Centimeter",
     col = "blue")
```

Utliggerne til høyre er der fordi det er beregnet gjennomsnittsinntekt av de to prosentene med høyest inntekt. Dette gjennomsnittet er brukt, og har erstattet alle de øverste verdiene.Vi merker oss også at histogrammet er tilnærmet normalfordelt, der de fleste observasjonene ligger mellom 160-180 cm. 

Som man kan se utfra histogrammet er det med flere uten inntekt i datasettet. Det kan man også se slik:

```{r echo=FALSE}
sum(hoyde$inntekt_nok == 0)
```

Det er altå 1740 personer uten inntekt med i datasettet.

**Vi må ha regresjonsanalyse (dokumentetLiten introduksjon til å kjøre regresjonsanalyser i Rkan være til hjelp)**

```{r eval=TRUE}
Inntekt <- hoyde$inntekt_nok
ggplot(hoyde = Inntekt) + theme_dark() +
  geom_density(aes(x = Inntekt), fill = "blue")
```
Denne grafen illustrerer inntekt, og her ser man ved første øyekast at det ikke er normalfordelt. Dette fordi man har mange observasjoner tilnærmet 0, og hovedvekten er <500,000.00 NOK. I andre enden av skalaen, de med 2% høyest inntekt er illustrert ved et gjennomsnitt av lønnen. Derfor foreligger det ingen observasjoner mellom 1,600,000.00 NOK og 3,000,000.00 NOK. 

```{r eval=TRUE}
Høyde <- hoyde$hoyde_cm
Inntekt <- hoyde$inntekt_nok
ggplot(hoyde = Høyde) + theme_dark() +
  geom_density(aes(x = Høyde), fill = "blue")
```
Ovenfor kan sees et density plot. Det vise hovedsaklig det samme som histogrammet, men man ser enklere tettheten av observasjonene her ved en jevn og fin kurve. Her ser man igjen, en tilnærmet normalfordeling.

```{r eval=TRUE}
#options(scipen = 999) #disabling scientific notation in R. vet ikke om vi skal ha med denne
Høyde <- hoyde$hoyde_cm
Inntekt <- hoyde$inntekt_nok
ggplot(hoyde, aes(Høyde, Inntekt)) +  theme_dark() +
  geom_point(color= "blue", size = 0.5) +
geom_smooth(formula = y ~ x, method = "lm", color= "orange")
```

```{r redusert datasett}
library(dplyr)
options(scipen = 999) #disabling scientific notation in R. vet ikke om vi skal ha med denne
hoyde = filter(hoyde, inntekt_nok != 0, inntekt_nok != "2922555") #brukt filter til å fjerne alle med inntekt = 0 og 2922555 (2% med høyest lønn)
ggplot(hoyde, aes(hoyde_cm, inntekt_nok)) +
  geom_point(color = "blue") + theme_dark() +
geom_smooth(formula = y ~ x, method = "lm", color = "orange") 
ggplot(hoyde,aes(hoyde_cm))+geom_histogram(bins=15, color = "blue") + theme_dark() 
```

**Vi benytter hele datasettet, men vil kjøre endelig modell også mot reduserte datasett (uten 2% topp inntekt og uten inntekt 0) for å teste modellens robusthet (huskfilterfunksjonen fraTidyverse)**

**Totalt skal minst 6 modeller estimeres**

**Resultatet fra estimeringen skal rapporteres vha. huxreg(). Se dokumentet ex_reg_tables.pdf underFiler \> Assignment 2 på Canvas, hvis du har glemt hvordan det gjøres. Tips: angir du en liste somførste argument til huxreg() kan du styre hva modellene skal hete, f.eks (gir også t-verdier istedenforstandard error)**

\*- **Den endelige modellen skal testes for robusthet på et datasett uten de 2% høyeste inntektene og på etdatasett som i tillegg ikke inneholder observasjoner der inntekten er 0.**

**Disse modellene på redusert datasett teller med blant de 6.Minst en av modellene skal inneholde interaksjon mht. variabelen sex. (Se eksempel 7.10 i dokumentetLiten intro)](<https://elastic-turing-41462a.netlify.app/presentations_ag/intro_econometrics/w_4c1_and_4c3>)))**

**Det skal gjøres test av koeffisientene vha. linearHypothesis() fra car pakken**

**Residualene fra endelig modell skal legges til datasettet hoyde. height_cm skal plottes mot residualenefor 'facet_grid(sex \~ factor(married, labels = c("not married," "married")))'**

**Plot av samtlige observasjoner svakt i bakgrunnen kan en få til med**

**Konklusjon Svar på spørsmålet: Er det høyde som bestemmer inntekt?**

# Referanser

::: {\#refs} \#jeg får ikke denne til å funke, kan du se Daniel? :::
